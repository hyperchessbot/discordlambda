<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
	  
    <meta property="og:type" content="object" />
    <meta property="og:site_name" content="discordlambda" />
    <meta property="og:url" content="https://discordlambda.netlify.app" />
    <meta property="og:title" content="Discord Lambda | Create Content With Discord Preview" />
    <meta property="og:description" content="Create your web page that is rendered as a preview when pasted into a Discord channel. Add your logo to the preview." />    
    <meta property="og:image" content="https://discordlambda.netlify.app/discordlambda.jpg" />
	  
    <title>Discord Lambda</title>
    <link rel="stylesheet" href="smartdom.css">
    <link rel="stylesheet" href="app.css">
    <script src="smartdom.js"></script>

  </head>

  <body>

    <div id="root"></div>

    <script>
    	class App extends SmartdomElement_{
    		constructor(...props){
    			super("div")

    			this.form = form().action("/.netlify/functions/index").post().blank().a(
    				Labeled("Name", this.nameInput = TextInput().id("name").sp("name")).ac("labeledinput"),
    				br(),
    				Labeled("Title", this.titleInput = TextInput().id("title").sp("title")).ac("labeledinput"),
    				br(),
    				Labeled("Description", this.descriptionInput = TextInput().id("description").sp("description")).ac("labeledinput"),
    				br(),
    				Labeled("Article", this.articleInput = TextArea().id("article").ac("article").sp("article")).ac("labeledinput"),
    				br(),
    				Labeled("Logo", this.logoInput = div().a(this.logoDiv = div().ac("logodiv"))).ac("labeledinput"),
    				br(),
    				this.fileBase64 = hidden("fileBase64"),
    				this.logoExt = hidden("logoExt"),
    				Submit("Submit")
    			)

    			this.logoDiv.e.addEventListener('dragover', e => {
					e.stopPropagation()
					e.preventDefault()
				})

				this.logoDiv.e.addEventListener('drop', e => {
			    	e.stopPropagation()
			    	e.preventDefault()
			    	const files = e.dataTransfer.files
			    	if(files.length > 0){
			    		const file = files[0]			    		
			    		const reader = new FileReader()
			    		reader.onload = e => {
			    			const result = e.target.result
			    			const b64 = btoa(result)			    			
			    			this.fileBase64.value(b64)			    			
			    			const parts = file.name.split("\.")
			    			const ext = parts[parts.length - 1]			    			
			    			console.log("file", ext)
			    			this.logoExt.value(ext)
			    			window.alert(`logo set to ${file.name} ( ${b64.length} byte(s) )`)

			    			reader.onload = e => {
			    				const result = e.target.result

			    				this.logoDiv.as("background-image", `url(${result})`).as("padding", "20px")
			    					.as("background-size", "100% 100%")
			    			}

			    			reader.readAsDataURL(file)
			    		}
			    		reader.readAsBinaryString(file)
			    	}
			    })

    			this.a(
    				this.form
    			)

    			document.getElementById("root").appendChild(this.e)
    		}
    	}

    	new App()

		/*const dropimge = document.getElementById("dropimg")
		dropimge.addEventListener('dragover', e => {
			e.stopPropagation()
			e.preventDefault()
		})

		dropimge.addEventListener('drop', e => {
	    	e.stopPropagation()
	    	e.preventDefault()
	    	const files = e.dataTransfer.files
	    	if(files.length > 0){
	    		const file = files[0]
	    		const reader = new FileReader()
	    		reader.onload = e => {
	    			let result = e.target.result
	    			let b64 = btoa(result)
	    			console.log("dropped file", b64)
	    			document.getElementById("filebase64").value = b64
	    		}
	    		reader.readAsBinaryString(file)
	    	}
	    })*/
	</script>

  </body>

</html>
